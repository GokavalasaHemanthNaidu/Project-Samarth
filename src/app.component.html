<div class="flex flex-col h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 shadow-sm p-4 z-10">
    <div class="max-w-4xl mx-auto flex items-center">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/55/Emblem_of_India.svg" alt="Emblem of India" class="h-10 w-10 mr-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Project Samarth</h1>
        <p class="text-sm text-gray-500">Intelligent Q&A for India's Agricultural & Climate Data</p>
      </div>
    </div>
  </header>

  <!-- Chat Area -->
  <main #chatContainer class="flex-1 overflow-y-auto p-4 md:p-6">
    <div class="max-w-4xl mx-auto space-y-6">
      @for (message of sanitizedMessages(); track $index) {
        <div class="flex" [class.justify-end]="message.role === 'user'">
          @if (message.role === 'model') {
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-sm shrink-0 mt-1">
                S
              </div>
              <div class="bg-white rounded-lg p-4 max-w-2xl border border-gray-200 shadow-sm message-content">
                <div [innerHTML]="message.htmlContent"></div>
              </div>
            </div>
          } @else {
            <div class="bg-blue-500 text-white rounded-lg p-4 max-w-xl shadow-sm">
              {{ message.content }}
            </div>
          }
        </div>
      }
      @if (isLoading() && messages()[messages().length - 1]?.role !== 'model') {
        <div class="flex items-start gap-3">
          <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-sm shrink-0 mt-1">S</div>
          <div class="bg-white rounded-lg p-4 max-w-2xl border border-gray-200 shadow-sm">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
              <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></div>
              <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></div>
            </div>
          </div>
        </div>
      }
    </div>
  </main>

  <!-- Input Area -->
  <footer class="bg-white border-t border-gray-200 p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Sample Questions -->
      @if (messages().length <= 1) {
        <div class="mb-3">
          <p class="text-sm text-gray-600 font-medium mb-2">Or try one of these sample questions:</p>
          <div class="flex flex-wrap gap-2">
            @for (sq of sampleQuestions(); track sq) {
              <button (click)="useSampleQuestion(sq)" 
                      class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center gap-2 text-left">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                <span>{{ sq }}</span>
              </button>
            }
          </div>
        </div>
      }
      <div class="flex items-start bg-gray-100 rounded-lg p-2 border border-gray-300 focus-within:ring-2 focus-within:ring-blue-500 transition-shadow">
        <textarea #inputBox 
          (input)="currentQuestion.set(inputBox.value)" 
          [value]="currentQuestion()"
          (keydown.enter)="handleEnterKey($event)"
          placeholder="Ask a question about agriculture and climate in India... (Shift+Enter for new line)"
          class="flex-1 bg-transparent border-none focus:ring-0 resize-none p-2 text-gray-800 placeholder-gray-500 max-h-36"
          rows="1"></textarea>
        <button (click)="sendMessage()" [disabled]="isLoading() || !currentQuestion().trim()"
                class="ml-2 px-4 py-2 rounded-md transition-colors text-white font-semibold self-end"
                [class.bg-blue-600]="!isLoading() && currentQuestion().trim()"
                [class.hover:bg-blue-700]="!isLoading() && currentQuestion().trim()"
                [class.bg-gray-400]="isLoading() || !currentQuestion().trim()"
                [class.cursor-not-allowed]="isLoading() || !currentQuestion().trim()">
          Send
        </button>
      </div>
    </div>
  </footer>
</div>